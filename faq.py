"""
Ø³ÙˆØ§Ù„Ø§Øª Ù…ØªØ¯Ø§ÙˆÙ„ â€” Ø¨Ø§ Ù…Ø­ØªÙˆØ§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ú©Ø§Ù…Ù„
"""
import logging
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import ContextTypes
from database import db

logger = logging.getLogger(__name__)

# Ø³ÙˆØ§Ù„Ø§Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ â€” Ø§Ú¯Ù‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø®Ø§Ù„ÛŒ Ø¨ÙˆØ¯ Ø§ÛŒÙ†Ø§ Ù†Ø´ÙˆÙ† Ø¯Ø§Ø¯Ù‡ Ù…ÛŒØ´Ù‡
DEFAULT_FAQS = {
    'ğŸ”¬ Ø¹Ù„ÙˆÙ… Ù¾Ø§ÛŒÙ‡': [
        ('Ø¹Ù„ÙˆÙ… Ù¾Ø§ÛŒÙ‡ Ú†ÛŒÙ‡ Ùˆ Ú†Ø·ÙˆØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†Ù…ØŸ',
         'Ø¨Ø®Ø´ Ø¹Ù„ÙˆÙ… Ù¾Ø§ÛŒÙ‡ Ø´Ø§Ù…Ù„ Ù…Ø­ØªÙˆØ§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ Ø¯Ø±ÙˆØ³ ØªØ±Ù… Û± ØªØ§ Ûµ Ø§Ø³Øª. Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ ğŸ“š Ù…Ù†Ø§Ø¨Ø¹ Ø¨Ø²Ù†ÛŒØ¯ØŒ Ø³Ù¾Ø³ Ø¹Ù„ÙˆÙ… Ù¾Ø§ÛŒÙ‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯. ØªØ±Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø±Ø¯Ù‡ Ùˆ Ø¯Ø±Ø³ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø¨ÛŒØ§Ø¨ÛŒØ¯. Ø¯Ø± Ù‡Ø± Ø¯Ø±Ø³ Ø¬Ù„Ø³Ø§Øª Ø¨Ù‡ ØªØ±ØªÛŒØ¨ Ù…Ø´Ø®Øµ Ø´Ø¯Ù‡ Ùˆ Ù…Ø­ØªÙˆØ§ÛŒ Ù‡Ø± Ø¬Ù„Ø³Ù‡ (ÙˆÛŒØ¯ÛŒÙˆØŒ Ø¬Ø²ÙˆÙ‡ØŒ Ù¾Ø§ÙˆØ±Ù¾ÙˆÛŒÙ†Øª Ùˆ...) Ù‚Ø§Ø¨Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ø³Øª.'),
        ('Ú†Ø·ÙˆØ± ÙˆÛŒØ¯ÛŒÙˆÛŒ ÛŒÚ© Ø¬Ù„Ø³Ù‡ Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ú©Ù†Ù…ØŸ',
         'Ù…Ø³ÛŒØ±: Ù…Ù†Ø§Ø¨Ø¹ â† Ø¹Ù„ÙˆÙ… Ù¾Ø§ÛŒÙ‡ â† ØªØ±Ù… Ù…Ø±Ø¨ÙˆØ·Ù‡ â† Ù†Ø§Ù… Ø¯Ø±Ø³ â† Ø´Ù…Ø§Ø±Ù‡ Ø¬Ù„Ø³Ù‡. Ø¯Ø± ØµÙØ­Ù‡ Ø¬Ù„Ø³Ù‡ØŒ ØªÙ…Ø§Ù… Ù…Ø­ØªÙˆØ§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ (ÙˆÛŒØ¯ÛŒÙˆØŒ Ù¾Ø§ÙˆØ±Ù¾ÙˆÛŒÙ†ØªØŒ Ø¬Ø²ÙˆÙ‡) Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.'),
        ('Ù…Ø­ØªÙˆØ§ÛŒ Ø¬Ø¯ÛŒØ¯ Ú©ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒØ´Ù‡ØŸ',
         'Ø§Ø¯Ù…ÛŒÙ† Ù…Ø­ØªÙˆØ§ Ø¨Ø¹Ø¯ Ø§Ø² Ù‡Ø± Ø¬Ù„Ø³Ù‡ Ú©Ù„Ø§Ø³ØŒ Ù…Ø­ØªÙˆØ§ Ø±Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Ø§Ú¯Ø± Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø±Ø¨Ø§Øª Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù‡ Ø¨Ø§Ø´ÛŒØ¯ØŒ ÙˆÙ‚ØªÛŒ Ù…Ø­ØªÙˆØ§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ø´ÙˆØ¯ Ù¾ÛŒØ§Ù… Ø¯Ø±ÛŒØ§ÙØª Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯.'),
    ],
    'ğŸ“š Ø±ÙØ±Ù†Ø³â€ŒÙ‡Ø§': [
        ('Ø±ÙØ±Ù†Ø³â€ŒÙ‡Ø§ Ú†ÛŒ Ù‡Ø³ØªÙ†ØŸ',
         'Ø±ÙØ±Ù†Ø³â€ŒÙ‡Ø§ Ú©ØªØ§Ø¨â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¬Ø¹ Ø¯Ø±Ø³ÛŒ Ù‡Ø³ØªÙ†Ø¯ Ú©Ù‡ Ø¯Ø± Ù‚Ø§Ù„Ø¨ PDF Ø§Ø±Ø§Ø¦Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯. Ù‡Ø± Ø¯Ø±Ø³ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ú†Ù†Ø¯ Ú©ØªØ§Ø¨ Ù…Ø±Ø¬Ø¹ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ Ùˆ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ú©ØªØ§Ø¨ Ù†Ø³Ø®Ù‡ ÙØ§Ø±Ø³ÛŒ (ØªØ±Ø¬Ù…Ù‡) ÛŒØ§ Ù„Ø§ØªÛŒÙ† (Ø§ØµÙ„ÛŒ) Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ø´Ø¯.'),
        ('ØªÙØ§ÙˆØª Ù†Ø³Ø®Ù‡ ÙØ§Ø±Ø³ÛŒ Ùˆ Ù„Ø§ØªÛŒÙ† Ú†ÛŒÙ‡ØŸ',
         'Ù†Ø³Ø®Ù‡ Ù„Ø§ØªÛŒÙ† Ù‡Ù…Ø§Ù† Ú©ØªØ§Ø¨ Ø§ØµÙ„ÛŒ Ø¨Ù‡ Ø²Ø¨Ø§Ù† Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø§Ø³Øª. Ù†Ø³Ø®Ù‡ ÙØ§Ø±Ø³ÛŒ ØªØ±Ø¬Ù…Ù‡ Ø¢Ù† Ú©ØªØ§Ø¨ Ø§Ø³Øª. Ø§Ù†ØªØ®Ø§Ø¨ Ø¨ÛŒÙ† Ø¯Ùˆ Ù†Ø³Ø®Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÛŒØ§Ø² Ùˆ Ø³Ø·Ø­ Ø²Ø¨Ø§Ù† Ø´Ù…Ø§ Ø§Ø³Øª.'),
    ],
    'ğŸ§ª Ø¨Ø§Ù†Ú© Ø³ÙˆØ§Ù„': [
        ('Ø¨Ø§Ù†Ú© Ø³ÙˆØ§Ù„ Ú†Ù‡ Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒÛŒ Ø¯Ø§Ø±Ù‡ØŸ',
         'Û±. Ø¨Ø§Ù†Ú© ÙØ§ÛŒÙ„ Ø§Ø¯Ù…ÛŒÙ†: ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ PDF Ø³ÙˆØ§Ù„Ø§Øª Ú©Ù‡ ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ† Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯Ù‡\nÛ². ØªÙ…Ø±ÛŒÙ† ØªØ³ØªÛŒ: Ø³ÙˆØ§Ù„Ø§Øª Ú†Ù‡Ø§Ø±Ú¯Ø²ÛŒÙ†Ù‡â€ŒØ§ÛŒ ØªØ¹Ø§Ù…Ù„ÛŒ\nÛ³. Ø·Ø±Ø§Ø­ÛŒ Ø³ÙˆØ§Ù„: Ø´Ù…Ø§ Ù‡Ù… Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø³ÙˆØ§Ù„ Ø·Ø±Ø§Ø­ÛŒ Ú©Ù†ÛŒØ¯'),
        ('Ú†Ø·ÙˆØ± Ø³ÙˆØ§Ù„ Ø·Ø±Ø§Ø­ÛŒ Ú©Ù†Ù…ØŸ',
         'Ø¯Ø± Ø¨Ø§Ù†Ú© Ø³ÙˆØ§Ù„ØŒ Ú¯Ø²ÛŒÙ†Ù‡ âœï¸ Ø·Ø±Ø§Ø­ÛŒ Ø³ÙˆØ§Ù„ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯. Ø¯Ø±Ø³ Ùˆ Ù…Ø¨Ø­Ø« Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø±Ø¯Ù‡ Ùˆ Ûµ Ù…Ø±Ø­Ù„Ù‡ Ø±Ø§ Ø·ÛŒ Ú©Ù†ÛŒØ¯: Ù…ØªÙ† Ø³ÙˆØ§Ù„ØŒ Û´ Ú¯Ø²ÛŒÙ†Ù‡ØŒ Ú¯Ø²ÛŒÙ†Ù‡ ØµØ­ÛŒØ­ØŒ Ø³Ø·Ø­ Ø³Ø®ØªÛŒØŒ ØªÙˆØ¶ÛŒØ­. Ø³ÙˆØ§Ù„ Ø´Ù…Ø§ Ø¨Ø¹Ø¯ Ø§Ø² ØªØ£ÛŒÛŒØ¯ Ø§Ø¯Ù…ÛŒÙ† Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.'),
        ('ØªÙ…Ø±ÛŒÙ† ØªØ³ØªÛŒ Ú†Ù‡ Ø­Ø§Ù„Øªâ€ŒÙ‡Ø§ÛŒÛŒ Ø¯Ø§Ø±Ù‡ØŸ',
         'â€¢ ØªÙ…Ø±ÛŒÙ† Ø¢Ø²Ø§Ø¯: Ø³ÙˆØ§Ù„â€ŒÙ‡Ø§ÛŒ ØªØµØ§Ø¯ÙÛŒ\nâ€¢ ØªÙ…Ø±ÛŒÙ† Ù†Ù‚Ø§Ø· Ø¶Ø¹Ù: Ø³ÙˆØ§Ù„â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ø´ØªØ¨Ø§Ù‡ Ø²Ø¯Ù‡â€ŒØ§ÛŒØ¯\nâ€¢ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ù…ØªØ­Ø§Ù†: Û²Û° Ø³ÙˆØ§Ù„ Ù¾Ø´Øª Ø³Ø± Ù‡Ù…\nâ€¢ Ø³ÙˆØ§Ù„Ø§Øª Ø³Ø®Øª: ÙÙ‚Ø· Ø³ÙˆØ§Ù„Ø§Øª Ø³Ø·Ø­ Ø¯Ø´ÙˆØ§Ø±'),
    ],
    'ğŸ“… Ø¨Ø±Ù†Ø§Ù…Ù‡ Ùˆ Ø§Ù…ØªØ­Ø§Ù†Ø§Øª': [
        ('ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ø§Ù…ØªØ­Ø§Ù† Ú†Ø·ÙˆØ± Ú©Ø§Ø± Ù…ÛŒÚ©Ù†Ù‡ØŸ',
         'Ø±Ø¨Ø§Øª Û· Ø±ÙˆØ²ØŒ Û³ Ø±ÙˆØ² Ùˆ Û± Ø±ÙˆØ² Ù‚Ø¨Ù„ Ø§Ø² Ù‡Ø± Ø§Ù…ØªØ­Ø§Ù† Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ù¾ÛŒØ§Ù… ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Ù…Ø´Ø±ÙˆØ· Ø¨Ù‡ Ø§ÛŒÙ†Ú©Ù‡ Ø§Ø¹Ù„Ø§Ù† Ø§Ù…ØªØ­Ø§Ù† Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø´Ù…Ø§ ÙØ¹Ø§Ù„ Ø¨Ø§Ø´Ø¯.'),
        ('Ú†Ø·ÙˆØ± Ø¨Ø±Ù†Ø§Ù…Ù‡ Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ Ø±Ùˆ Ø¨Ø¨ÛŒÙ†Ù…ØŸ',
         'Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ ğŸ“… Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¨Ø²Ù†ÛŒØ¯. Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ØŒ Ø§Ù…ØªØ­Ø§Ù†Ø§ØªØŒ Ùˆ Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ Ø¬Ø¨Ø±Ø§Ù†ÛŒ Ø±Ø§ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø¨Ø¨ÛŒÙ†ÛŒØ¯.'),
    ],
    'ğŸ‘¤ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ': [
        ('Ú†Ø±Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±Ù…ØŸ',
         'Ø¨Ø¹Ø¯ Ø§Ø² Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…ØŒ Ø§Ø¯Ù…ÛŒÙ† Ø¨Ø§ÛŒØ¯ Ø­Ø³Ø§Ø¨ Ø´Ù…Ø§ Ø±Ø§ ØªØ£ÛŒÛŒØ¯ Ú©Ù†Ø¯. Ø§ÛŒÙ† ÙØ±Ø§ÛŒÙ†Ø¯ Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ú©Ù…ØªØ± Ø§Ø² Û²Û´ Ø³Ø§Ø¹Øª Ø·ÙˆÙ„ Ù…ÛŒâ€ŒÚ©Ø´Ø¯. Ø§Ú¯Ø± Ø¨ÛŒØ´ØªØ± Ø§Ø² Û²Û´ Ø³Ø§Ø¹Øª Ú¯Ø°Ø´ØªÙ‡ØŒ Ø¨Ø§ Ø§Ø¯Ù…ÛŒÙ† ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯.'),
        ('Ø´Ù…Ø§Ø±Ù‡ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒÛŒ Ø§Ø´ØªØ¨Ø§Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù… Ú†ÛŒÚ©Ø§Ø± Ú©Ù†Ù…ØŸ',
         'Ø¨Ø§ Ø§Ø¯Ù…ÛŒÙ† ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯ ØªØ§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ù…Ø§ ÙˆÛŒØ±Ø§ÛŒØ´ Ø´ÙˆØ¯.'),
        ('Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§ Ø±Ùˆ Ú†Ø·ÙˆØ± Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù†Ù…ØŸ',
         'Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ ğŸ”” Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§ Ø¨Ø²Ù†ÛŒØ¯. Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ù‡ ØµÙˆØ±Øª Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø§Ø¹Ù„Ø§Ù† Ù…Ù†Ø§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ØŒ ØªØºÛŒÛŒØ± Ø¨Ø±Ù†Ø§Ù…Ù‡ØŒ ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ø§Ù…ØªØ­Ø§Ù† Ùˆ Ø³ÙˆØ§Ù„ Ø±ÙˆØ²Ø§Ù†Ù‡ Ø±Ø§ Ø±ÙˆØ´Ù† ÛŒØ§ Ø®Ø§Ù…ÙˆØ´ Ú©Ù†ÛŒØ¯.'),
    ],
    'âš™ï¸ Ù…Ø´Ú©Ù„Ø§Øª ÙÙ†ÛŒ': [
        ('Ø±Ø¨Ø§Øª Ø¬ÙˆØ§Ø¨ Ù†Ù…ÛŒØ¯Ù‡ Ú†ÛŒÚ©Ø§Ø± Ú©Ù†Ù…ØŸ',
         '/start Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯ ØªØ§ Ø±Ø¨Ø§Øª Ù…Ø¬Ø¯Ø¯ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø´ÙˆØ¯. Ø§Ú¯Ø± Ù…Ø´Ú©Ù„ Ø§Ø¯Ø§Ù…Ù‡ Ø¯Ø§Ø´ØªØŒ Ú†Ù†Ø¯ Ø¯Ù‚ÛŒÙ‚Ù‡ ØµØ¨Ø± Ú©Ù†ÛŒØ¯ Ùˆ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯.'),
        ('ÙØ§ÛŒÙ„ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù†Ù…ÛŒØ´Ù‡ØŸ',
         'Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø´Ù…Ø§ Ø¨Ø±Ù‚Ø±Ø§Ø± Ø§Ø³Øª. Ú¯Ø§Ù‡ÛŒ Telegram Ø¨Ø±Ø§ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø²Ø±Ú¯ Ø²Ù…Ø§Ù† Ø¨ÛŒØ´ØªØ±ÛŒ Ù…ÛŒâ€ŒØ¨Ø±Ø¯. Ø§Ú¯Ø± Ù…Ø´Ú©Ù„ Ø§Ø¯Ø§Ù…Ù‡ Ø¯Ø§Ø´Øª Ø¨Ø§ Ø§Ø¯Ù…ÛŒÙ† ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯.'),
    ],
}


async def faq_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    data = query.data
    parts = data.split(':')
    action = parts[1] if len(parts) > 1 else 'main'

    if action == 'main':
        await _faq_main(query, context)

    elif action == 'cat':
        idx = int(parts[2])
        await _faq_list(query, context, idx)

    elif action == 'item':
        cat_idx = int(parts[2])
        item_idx = int(parts[3])
        await _faq_answer(query, context, cat_idx, item_idx)

    elif action == 'back_cats':
        await _faq_main(query, context)


async def _get_faq_data(context):
    """Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ FAQ â€” Ø§Ú¯Ù‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø¯Ø§Ø´Øª Ø§Ø² Ø§ÙˆÙ†Ø¬Ø§ØŒ ÙˆÚ¯Ø±Ù†Ù‡ Ù¾ÛŒØ´â€ŒÙØ±Ø¶"""
    db_faqs = await db.faq_get_all()
    if db_faqs:
        # Ø³Ø§Ø®ØªØ§Ø±Ø¯Ù‡ÛŒ Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³
        cats = {}
        for f in db_faqs:
            cat = f.get('category', 'Ø¹Ù…ÙˆÙ…ÛŒ')
            cats.setdefault(cat, []).append((f['question'], f['answer']))
        return cats
    return DEFAULT_FAQS


async def _faq_main(query, context):
    faq_data = await _get_faq_data(context)
    context.user_data['_faq_data'] = faq_data
    cats = list(faq_data.keys())

    keyboard = []
    for i, cat in enumerate(cats):
        count = len(faq_data[cat])
        keyboard.append([InlineKeyboardButton(
            f"{cat} ({count} Ø³ÙˆØ§Ù„)", callback_data=f'faq:cat:{i}'
        )])

    await query.edit_message_text(
        "â“ <b>Ø³ÙˆØ§Ù„Ø§Øª Ù…ØªØ¯Ø§ÙˆÙ„</b>\n\n"
        "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n"
        "Ø¯Ø± Ú©Ø¯Ø§Ù… Ø¨Ø®Ø´ Ø³ÙˆØ§Ù„ Ø¯Ø§Ø±ÛŒØ¯ØŸ",
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )


async def _faq_list(query, context, cat_idx):
    faq_data = context.user_data.get('_faq_data') or await _get_faq_data(context)
    context.user_data['_faq_data'] = faq_data
    cats = list(faq_data.keys())

    if cat_idx >= len(cats):
        await query.answer("âŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯!", show_alert=True)
        return

    cat = cats[cat_idx]
    items = faq_data[cat]

    keyboard = []
    for i, (q, _) in enumerate(items):
        keyboard.append([InlineKeyboardButton(
            f"â“ {q[:45]}", callback_data=f'faq:item:{cat_idx}:{i}'
        )])
    keyboard.append([InlineKeyboardButton("ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª", callback_data='faq:back_cats')])

    await query.edit_message_text(
        f"{cat}\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n"
        "Ø±ÙˆÛŒ Ù‡Ø± Ø³ÙˆØ§Ù„ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯:",
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )


async def _faq_answer(query, context, cat_idx, item_idx):
    faq_data = context.user_data.get('_faq_data') or await _get_faq_data(context)
    cats = list(faq_data.keys())

    if cat_idx >= len(cats):
        await query.answer("âŒ Ø®Ø·Ø§!", show_alert=True)
        return

    cat = cats[cat_idx]
    items = faq_data[cat]

    if item_idx >= len(items):
        await query.answer("âŒ Ø³ÙˆØ§Ù„ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯!", show_alert=True)
        return

    question, answer = items[item_idx]

    await query.edit_message_text(
        f"â“ <b>{question}</b>\n\n"
        f"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n"
        f"ğŸ’¡ {answer}",
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø³ÙˆØ§Ù„Ø§Øª", callback_data=f'faq:cat:{cat_idx}')],
            [InlineKeyboardButton("ğŸ  Ù‡Ù…Ù‡ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§", callback_data='faq:back_cats')]
        ])
    )
